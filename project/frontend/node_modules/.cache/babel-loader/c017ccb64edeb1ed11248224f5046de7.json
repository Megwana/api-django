{"ast":null,"code":"import _objectSpread from\"/workspace/api-django/project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/workspace/api-django/project/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/workspace/api-django/project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from\"react\";import styles from\"../../styles/Post.module.css\";import{useCurrentUser}from\"../../contexts/CurrentUserContext\";import{Card,Media,OverlayTrigger,Tooltip}from\"react-bootstrap\";import{Link,useHistory}from\"react-router-dom\";import Avatar from\"../../components/Avatar\";import{axiosRes}from\"../../api/axiosDefaults\";import{MoreDropdown}from\"../../components/MoreDropdown\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Post=function Post(props){var id=props.id,owner=props.owner,profile_id=props.profile_id,profile_image=props.profile_image,comments_count=props.comments_count,likes_count=props.likes_count,like_id=props.like_id,title=props.title,content=props.content,image=props.image,updated_at=props.updated_at,postPage=props.postPage,setPosts=props.setPosts;var currentUser=useCurrentUser();var is_owner=(currentUser===null||currentUser===void 0?void 0:currentUser.username)===owner;var history=useHistory();var handleEdit=function handleEdit(){history.push(\"/posts/\".concat(id,\"/edit\"));};var handleDelete=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axiosRes.delete(\"/posts/\".concat(id,\"/\"));case 3:history.goBack();_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 9:case\"end\":return _context.stop();}},_callee,null,[[0,6]]);}));return function handleDelete(){return _ref.apply(this,arguments);};}();var handleLike=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _yield$axiosRes$post,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axiosRes.post(\"/likes/\",{post:id});case 3:_yield$axiosRes$post=_context2.sent;data=_yield$axiosRes$post.data;setPosts(function(prevPosts){return _objectSpread(_objectSpread({},prevPosts),{},{results:prevPosts.results.map(function(post){return post.id===id?_objectSpread(_objectSpread({},post),{},{likes_count:post.likes_count+1,like_id:data.id}):post;})});});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return function handleLike(){return _ref2.apply(this,arguments);};}();var handleUnlike=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axiosRes.delete(\"/likes/\".concat(like_id,\"/\"));case 3:setPosts(function(prevPosts){return _objectSpread(_objectSpread({},prevPosts),{},{results:prevPosts.results.map(function(post){return post.id===id?_objectSpread(_objectSpread({},post),{},{likes_count:post.likes_count-1,like_id:null}):post;})});});_context3.next=9;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 9:case\"end\":return _context3.stop();}},_callee3,null,[[0,6]]);}));return function handleUnlike(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Card,{className:styles.Post,children:[/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(Media,{className:\"align-items-center justify-content-between\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/profiles/\".concat(profile_id),children:[/*#__PURE__*/_jsx(Avatar,{src:profile_image,height:55}),owner]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"span\",{children:updated_at}),is_owner&&postPage&&/*#__PURE__*/_jsx(MoreDropdown,{handleEdit:handleEdit,handleDelete:handleDelete})]})]})}),/*#__PURE__*/_jsx(Link,{to:\"/posts/\".concat(id),children:/*#__PURE__*/_jsx(Card.Img,{src:image,alt:title})}),/*#__PURE__*/_jsxs(Card.Body,{children:[title&&/*#__PURE__*/_jsx(Card.Title,{className:\"text-center\",children:title}),content&&/*#__PURE__*/_jsx(Card.Text,{children:content}),/*#__PURE__*/_jsxs(\"div\",{className:styles.PostBar,children:[is_owner?/*#__PURE__*/_jsx(OverlayTrigger,{placement:\"top\",overlay:/*#__PURE__*/_jsx(Tooltip,{children:\"You can't like your own post!\"}),children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-heart\"})}):like_id?/*#__PURE__*/_jsx(\"span\",{onClick:handleUnlike,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-heart \".concat(styles.Heart)})}):currentUser?/*#__PURE__*/_jsx(\"span\",{onClick:handleLike,children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-heart \".concat(styles.HeartOutline)})}):/*#__PURE__*/_jsx(OverlayTrigger,{placement:\"top\",overlay:/*#__PURE__*/_jsx(Tooltip,{children:\"Log in to like posts!\"}),children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-heart\"})}),likes_count,/*#__PURE__*/_jsx(Link,{to:\"/posts/\".concat(id),children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-comments\"})}),comments_count]})]})]});};export default Post;","map":{"version":3,"names":["React","styles","useCurrentUser","Card","Media","OverlayTrigger","Tooltip","Link","useHistory","Avatar","axiosRes","MoreDropdown","jsx","_jsx","jsxs","_jsxs","Post","props","id","owner","profile_id","profile_image","comments_count","likes_count","like_id","title","content","image","updated_at","postPage","setPosts","currentUser","is_owner","username","history","handleEdit","push","concat","handleDelete","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","delete","goBack","t0","console","log","stop","apply","arguments","handleLike","_ref2","_callee2","_yield$axiosRes$post","data","_callee2$","_context2","post","sent","prevPosts","_objectSpread","results","map","handleUnlike","_ref3","_callee3","_callee3$","_context3","className","children","Body","to","src","height","Img","alt","Title","Text","PostBar","placement","overlay","onClick","Heart","HeartOutline"],"sources":["/workspace/api-django/project/frontend/src/pages/posts/Post.js"],"sourcesContent":["import React from \"react\";\nimport styles from \"../../styles/Post.module.css\";\nimport { useCurrentUser } from \"../../contexts/CurrentUserContext\";\nimport { Card, Media, OverlayTrigger, Tooltip } from \"react-bootstrap\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport Avatar from \"../../components/Avatar\";\nimport { axiosRes } from \"../../api/axiosDefaults\";\nimport { MoreDropdown } from \"../../components/MoreDropdown\";\n\nconst Post = (props) => {\n  const {\n    id,\n    owner,\n    profile_id,\n    profile_image,\n    comments_count,\n    likes_count,\n    like_id,\n    title,\n    content,\n    image,\n    updated_at,\n    postPage,\n    setPosts,\n  } = props;\n\n  const currentUser = useCurrentUser();\n  const is_owner = currentUser?.username === owner;\n  const history = useHistory();\n\n  const handleEdit = () => {\n    history.push(`/posts/${id}/edit`);\n  };\n\n  const handleDelete = async () => {\n    try {\n      await axiosRes.delete(`/posts/${id}/`);\n      history.goBack();\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const handleLike = async () => {\n    try {\n      const { data } = await axiosRes.post(\"/likes/\", { post: id });\n      setPosts((prevPosts) => ({\n        ...prevPosts,\n        results: prevPosts.results.map((post) => {\n          return post.id === id\n            ? { ...post, likes_count: post.likes_count + 1, like_id: data.id }\n            : post;\n        }),\n      }));\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const handleUnlike = async () => {\n    try {\n      await axiosRes.delete(`/likes/${like_id}/`);\n      setPosts((prevPosts) => ({\n        ...prevPosts,\n        results: prevPosts.results.map((post) => {\n          return post.id === id\n            ? { ...post, likes_count: post.likes_count - 1, like_id: null }\n            : post;\n        }),\n      }));\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return (\n    <Card className={styles.Post}>\n      <Card.Body>\n        <Media className=\"align-items-center justify-content-between\">\n          <Link to={`/profiles/${profile_id}`}>\n            <Avatar src={profile_image} height={55} />\n            {owner}\n          </Link>\n          <div className=\"d-flex align-items-center\">\n            <span>{updated_at}</span>\n            {is_owner && postPage && (\n              <MoreDropdown\n                handleEdit={handleEdit}\n                handleDelete={handleDelete}\n              />\n            )}\n          </div>\n        </Media>\n      </Card.Body>\n      <Link to={`/posts/${id}`}>\n        <Card.Img src={image} alt={title} />\n      </Link>\n      <Card.Body>\n        {title && <Card.Title className=\"text-center\">{title}</Card.Title>}\n        {content && <Card.Text>{content}</Card.Text>}\n        <div className={styles.PostBar}>\n          {is_owner ? (\n            <OverlayTrigger\n              placement=\"top\"\n              overlay={<Tooltip>You can't like your own post!</Tooltip>}\n            >\n              <i className=\"far fa-heart\" />\n            </OverlayTrigger>\n          ) : like_id ? (\n            <span onClick={handleUnlike}>\n              <i className={`fas fa-heart ${styles.Heart}`} />\n            </span>\n          ) : currentUser ? (\n            <span onClick={handleLike}>\n              <i className={`far fa-heart ${styles.HeartOutline}`} />\n            </span>\n          ) : (\n            <OverlayTrigger\n              placement=\"top\"\n              overlay={<Tooltip>Log in to like posts!</Tooltip>}\n            >\n              <i className=\"far fa-heart\" />\n            </OverlayTrigger>\n          )}\n          {likes_count}\n          <Link to={`/posts/${id}`}>\n            <i className=\"far fa-comments\" />\n          </Link>\n          {comments_count}\n        </div>\n      </Card.Body>\n    </Card>\n  );\n};\n\nexport default Post;"],"mappings":"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"},"metadata":{},"sourceType":"module"}